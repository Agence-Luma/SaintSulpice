import{S as P,c as z}from"./DqRuGDLG.js";import{l as q,h as k,p as Z,o as _,c as p,m as c,q as v,r as $,n as C,s as O,v as y,x as L,w as H,b as F}from"./CkR8XCFB.js";let a=(function(e){return e.Slices="slices",e.ActiveSlice="activeSlice",e.Message="message",e})({});const h="slice-simulator",S="slice-simulator--root",N=()=>document.querySelector(`.${h}`),B=()=>document.querySelector(`.${S}`),x=e=>{let t=document.querySelector(`.${h} [data-slice-zone]`);if(t)return t.children.length!==e&&console.warn(`Flagged SliceZone has an unexpected number of children, found ${t.children.length} but expected ${e}. This might lead to unexpected behaviors. Are you sure you tagged the right element?`),t;if(t=document.querySelector(`.${h} .${S}`),!t)return null;const s=5;for(let i=0;i<s;i++){if(t.children.length===e)return t;if(t.children.length)t=t.children[0];else break}return null},j=(e,t)=>{const s=document.elementsFromPoint(t.x,t.y).reverse(),i=s.indexOf(e);if(i===-1)return null;const n=s[i+1];return n||null},w=()=>({zIndex:100,background:"#ffffff"}),R=()=>[],U=()=>"",D=(e,t=16)=>{let s=0,i=null;return function(...n){const r=Date.now(),o=r-s;o>=t?(e.apply(this,n),s=r):(i&&clearTimeout(i),i=setTimeout(()=>{e.apply(this,n),s=Date.now()},t-o))}};var V=class{_listeners={};on(e,t,s=null){this._listeners[e]=[...this._listeners[e]??[],[t,s]]}off(e,t){this._listeners[e]=(this._listeners[e]??[]).filter(([s,i])=>typeof t=="function"?s!==t:i!==t)}emit(e,t){(this._listeners[e]??[]).forEach(s=>s[0](t))}},J=class extends V{_slices;set slices(e){this._slices=e,this.message="",this.emit(a.Slices,e)}get slices(){return this._slices}_activeSlice;set activeSlice(e){this._activeSlice=e,this.emit(a.ActiveSlice,e)}get activeSlice(){return this._activeSlice}_message;set message(e){this._message=e,this.emit(a.Message,e)}get message(){return this._message}_mouse;constructor(e){super(),this._slices=e?.slices||R(),this._activeSlice=null,this._message="",this._mouse={x:0,y:0}}async init(){window.addEventListener("mousemove",e=>{this._mouse={x:e.clientX,y:e.clientY}})}_setActiveSlice=()=>{if(this.slices.length===0){this.activeSlice=null;return}const e=x(this.slices.length);if(!e){this.activeSlice=null;return}const t=j(e,this._mouse);if(!t){this.activeSlice=null;return}const s=Array.prototype.indexOf.call(e.children,t);this.activeSlice={rect:t.getBoundingClientRect(),sliceID:this.slices[s].slice_type,variationID:this.slices[s].variation,index:s}};setActiveSlice=D(this._setActiveSlice,16);setSliceZone(e){this.slices=e}};const Y=e=>`<div style="word-spacing: initial; white-space: pre; line-height: initial; font-family: monospace; color: #ffffff; mix-blend-mode: difference; padding: 1rem; font-size: 1rem;">${e}</div>`,f=(e,t)=>`<a href="${e}" style="text-decoration: underline;">${e}<a>`,X=`   _____ ___          _____ _                 __      __            
  / ___// (_)_______ / ___/(_)___ ___  __  __/ /___ _/ /_____  _____
  \\__ \\/ / / ___/ _ \\\\__ \\/ / __ \`__ \\/ / / / / __ \`/ __/ __ \\/ ___/
 ___/ / / / /__/  __/__/ / / / / / / / /_/ / / /_/ / /_/ /_/ / /    
/____/_/_/\\___/\\___/____/_/_/ /_/ /_/\\__,_/_/\\__,_/\\__/\\____/_/     
                  / /_  __  __   / __ \\_____(_)________ ___  (_)____
                 / __ \\/ / / /  / /_/ / ___/ / ___/ __ \`__ \\/ / ___/
                / /_/ / /_/ /  / ____/ /  / (__  ) / / / / / / /__  
               /_.___/\\__, /  /_/   /_/  /_/____/_/ /_/ /_/_/\\___/  
                     /____/

`,G=`





                                                - The Prismic team`,Q=Y([X,`You're seeing this page because you're accessing Slice simulator
directly, e.g:

  - ${f("http://localhost:3000/slice-simulator")}



The Slice simulator can only be accessed through Slice Machine or the
Page Builder. To preview your Slices, head over to Slice Machine:

  - ${f("http://localhost:9999")}



If you believe this is an error, please reach out to us:

  - ${f("https://github.com/prismicio/slice-machine/issues/new/choose")}`,G].join(""));let u=(function(e){return e.SetActiveSlice="setActiveSlice",e.SetSliceZoneSize="setSliceZoneSize",e})({}),m=(function(e){return e.Ping="ping",e.SetSliceZone="setSliceZone",e.ScrollToSlice="scrollToSlice",e})({});var g=class extends Error{response;constructor(e){super(e.msg),this.response=e}},W=class extends Error{request;constructor(e){super("Too many concurrent requests"),this.request=e}},K=class extends Error{request;constructor(e){super(`Request \`${e.requestID}\` timed out`),this.request=e}},ee=class extends Error{},te=class extends Error{constructor(){super("Port is not set")}};const M={200:"ok",201:"created",400:"bad request",500:"internal server error",501:"not implemented"};let se=0;const ie=(e,t,s="")=>({requestID:`${s}${se++}`,type:e,data:t}),E=(e,t,s=200)=>{if(s>=400)throw new TypeError(`Invalid success status code, expected status to be within \`[100;400[\`, got \`${s}\``);return{requestID:e,status:s,msg:M[s]??"",data:t}},d=(e,t,s=400)=>{if(s<400)throw new TypeError(`Invalid error status code, expected status to be within \`[400;600[\`, got \`${s}\``);return{requestID:e,status:s,msg:M[s]??"",error:t}},A=e=>{if(typeof e!="object"||e===null)throw new TypeError(`Invalid message received, expected message to be of type \`object\`, got \`${typeof e}\``);if(Object.keys(e).every(t=>["requestID","type","data","status","msg","error"].includes(t))){if(typeof e.requestID!="string")throw new TypeError(`Invalid message received, expected \`message.requestID\` to be of type \`string\`, got \`${typeof e.id}\``)}else throw new TypeError(`Invalid message received: ${JSON.stringify(e)}`);return e},T=e=>"type"in e,ne=e=>!("type"in e),re=e=>ne(e)&&!("error"in e),oe={debug:!1,maximumRequestConcurrency:20,defaultTimeout:5e3,requestIDPrefix:"channel-"};var ce=class{requestHandlers;options;_port=null;get port(){if(!this._port)throw new te;return this._port}set port(e){this._port&&(this._port.onmessage=null),this._port=e,this._port&&(this._port.onmessage=this.onMessage.bind(this))}_pendingRequests=new Map;constructor(e,t){this.requestHandlers=e,this.options={...oe,...t}}createRequestMessage(e,t){return ie(e,t,this.options.requestIDPrefix)}async onMessage(e){this.options.debug&&console.debug(e.data);try{const t=A(e.data);if(T(t))if(!this.requestHandlers[t.type])this.postResponse(d(t.requestID,void 0,501));else try{const s=await this.requestHandlers[t.type](t,{success:E.bind(this,t.requestID),error:d.bind(this,t.requestID)});this.postResponse(s)}catch(s){this.postResponse(d(t.requestID,s,500))}else this._pendingRequests.has(t.requestID)?(this._pendingRequests.get(t.requestID)(t),this._pendingRequests.delete(t.requestID)):console.error(`Unknown request ID received in response: ${JSON.stringify(t)}`)}catch(t){if(t instanceof TypeError)console.warn(t.message);else throw t}}postRequest(e,t=i=>this.port.postMessage(i),s={}){if(this.options.debug&&console.debug(e),this._pendingRequests.size>=this.options.maximumRequestConcurrency)throw new W(e);return new Promise((i,n)=>{const r=setTimeout(()=>{this._pendingRequests.has(e.requestID)&&this._pendingRequests.delete(e.requestID),n(new K(e))},s.timeout||this.options.defaultTimeout);this._pendingRequests.set(e.requestID,o=>{clearTimeout(r),re(o)?i(o):n(new g(o))}),t(e)})}postResponse(e,t=s=>this.port.postMessage(s)){return this.options.debug&&console.debug(e),t(e),e}};let ae=(function(e){return e.Connect="connect",e})({}),le=(function(e){return e.Ready="ready",e})({});const ue={readyTimeout:2e4,requestIDPrefix:"receiver-"};var _e=class extends ce{_ready=!1;constructor(e,t){super(e,{...ue,...t}),window.addEventListener("message",s=>{this._onPublicMessage(s)})}async ready(){if(window.parent===window)throw new Error("Receiver is currently not embedded as an iframe");this._ready=!1;const e=this.createRequestMessage(le.Ready,void 0),t=await this.postRequest(e,s=>{window.parent.postMessage(s,"*")},{timeout:this.options.readyTimeout});return this._ready=!0,t}_onPublicMessage(e){try{const t=A(e.data);if(T(t))if(this.options.debug&&console.debug(e.data),t.type===ae.Connect){this.port=e.ports[0];const{data:s}=t;this.options={...this.options,...s,debug:this.options.debug,requestIDPrefix:this.options.requestIDPrefix,readyTimeout:this.options.readyTimeout};const i=E(t.requestID,void 0);this.postResponse(i)}else this.postResponse(d(t.requestID,void 0),n=>{e.source.postMessage(n,e.origin)});else this._ready||this.onMessage(e)}catch(t){if(!(t instanceof TypeError))throw t}}postFormattedRequest(e,t,s={}){if(!this._ready)throw new ee("Receiver is not ready, use `ChannelReceiver.ready()` first");return this.postRequest(this.createRequestMessage(e,t),void 0,s)}};const de={requestIDPrefix:"api-",activeSliceAPI:!1,sliceZoneSizeAPI:!1};var he=class extends _e{constructor(e,t){const s=t?.debug||/[?&]debug=true/i.test(decodeURIComponent(window.location.search));if(super({[m.Ping]:(o,l)=>l.success("pong"),...e},{...de,...t,debug:s}),s){var i,n,r;(i=window).prismic||(i.prismic={}),(n=window.prismic).sliceSimulator||(n.sliceSimulator={}),(r=window.prismic.sliceSimulator).api||(r.api=[]),window.prismic.sliceSimulator.api.push(this)}}[u.SetActiveSlice]=async e=>await this.postFormattedRequest(u.SetActiveSlice,e);[u.SetSliceZoneSize]=async e=>await this.postFormattedRequest(u.SetSliceZoneSize,e)},pe=class{state;_api;_initialized;constructor(e){this.state=new J(e),this._api=null,this._initialized=!1}async init(){if(!this._initialized){this._initialized=!0,await this.state.init();try{await this._initAPI()}catch(e){e instanceof Error&&e.message==="Receiver is currently not embedded as an iframe"&&!this.state.slices.length&&(this.state.message=Q),console.error(e);return}this._initListeners()}}async _initAPI(){this._api=new he({[m.SetSliceZone]:(e,t)=>(this.state.setSliceZone(e.data),t.success()),[m.ScrollToSlice]:(e,t)=>{var s;if(e.data.sliceIndex<0)return t.error("`sliceIndex` must be > 0",400);if(e.data.sliceIndex>=this.state.slices.length)return t.error(`\`sliceIndex\` must be < ${this.state.slices.length} (\`<SliceZone />\` current length)`,400);const i=x(this.state.slices.length);if(!i)return t.error("Failed to find `<SliceZone />`",500);this.state.activeSlice=null;const n=i.children[e.data.sliceIndex];return n?(n.scrollIntoView({behavior:e.data.behavior,block:e.data.block,inline:e.data.inline}),!((s=this._api)===null||s===void 0)&&s.options.activeSliceAPI&&setTimeout(this.state.setActiveSlice,750),t.success()):t.error("Failed fo find slice at index $`{req.data.sliceIndex}` in `<SliceZone />`",500)}}),await this._api.ready()}_initListeners(){var e,t;if(!((e=this._api)===null||e===void 0)&&e.options.activeSliceAPI&&(window.addEventListener("mousemove",()=>{this.state.setActiveSlice()}),window.addEventListener("resize",()=>{this.state.setActiveSlice()}),window.addEventListener("mousewheel",()=>{setTimeout(this.state.setActiveSlice,200)}),this.state.on(a.Slices,()=>{this.state.setActiveSlice()}),this.state.on(a.ActiveSlice,async s=>{if(this._api)try{await this._api.setActiveSlice(s)}catch(i){if(i instanceof g&&i.response.status===400)console.error(i.response);else throw i}})),!((t=this._api)===null||t===void 0)&&t.options.sliceZoneSizeAPI){const s=new ResizeObserver(D(async n=>{const[r]=n;if(this._api&&r)try{await this._api.setSliceZoneSize({rect:r.contentRect})}catch(o){if(o instanceof g&&o.response.status===400)console.error(o.response);else throw o}},16)),i=()=>{const n=B();s.disconnect(),n&&s.observe(n)};new MutationObserver(i).observe(N(),{subtree:!1,childList:!0})}}};const b=e=>{e.preventDefault(),e.stopPropagation()},I=e=>{e.path&&e.path.slice(0,5).some(t=>t instanceof HTMLAnchorElement)&&(e.preventDefault(),e.stopPropagation())},fe=["innerHTML"];var me=q({name:"SliceSimulator",__name:"SliceSimulator",props:{zIndex:{type:Number,required:!1},background:{type:String,required:!1}},setup(e){const t=e,s=y(R()),i=y(U()),n=new pe;return k(()=>{n.state.on(a.Slices,r=>{s.value=r},"simulator-slices"),n.state.on(a.Message,r=>{i.value=r},"simulator-message"),n.init()}),Z(()=>{n.state.off(a.Slices,"simulator-slices"),n.state.off(a.Message,"simulator-message")}),(r,o)=>(_(),p("div",{class:v(c(h)),style:O({zIndex:t.zIndex||c(w)().zIndex,position:"fixed",top:0,left:0,width:"100%",height:"100vh",overflow:"auto",background:t.background||c(w)().background})},[i.value?(_(),p("article",{key:0,innerHTML:i.value},null,8,fe)):s.value.length?(_(),p("div",{key:1,id:"root",class:v(c(S)),onClickCapture:o[0]||(o[0]=(...l)=>c(I)&&c(I)(...l)),onSubmitCapture:o[1]||(o[1]=(...l)=>c(b)&&c(b)(...l))},[$(r.$slots,"default",{slices:s.value})],34)):C("v-if",!0)],6))}}),ge=me;const ye=q({__name:"slice-simulator",setup(e){return(t,s)=>{const i=P,n=ge;return _(),L(n,null,{default:H(({slices:r})=>[F(i,{slices:r,components:c(z)},null,8,["slices","components"])]),_:1})}}});export{ye as default};
